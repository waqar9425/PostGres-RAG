{
  "doc_name": "sql-set-transaction",
  "url": "https://www.postgresql.org/docs/16/sql-set-transaction.html",
  "sections": [
    {
      "title": "SET TRANSACTION",
      "text": "SET TRANSACTION — set the characteristics of the current transaction\n"
    },
    {
      "title": "Synopsis",
      "text": "\n\nCODE:\n\nSET TRANSACTION transaction_mode [, ...]\nSET TRANSACTION SNAPSHOT snapshot_id\nSET SESSION CHARACTERISTICS AS TRANSACTION transaction_mode [, ...]\n\nwhere transaction_mode is one of:\n\n    ISOLATION LEVEL { SERIALIZABLE | REPEATABLE READ | READ COMMITTED | READ UNCOMMITTED }\n    READ WRITE | READ ONLY\n    [ NOT ] DEFERRABLE\n\n"
    },
    {
      "title": "Description",
      "text": "TheSET TRANSACTIONcommand sets the characteristics of the current transaction. It has no effect on any subsequent transactions.SET SESSION CHARACTERISTICSsets the default transaction characteristics for subsequent transactions of a session. These defaults can be overridden bySET TRANSACTIONfor an individual transaction.\nThe available transaction characteristics are the transaction isolation level, the transaction access mode (read/write or read-only), and the deferrable mode. In addition, a snapshot can be selected, though only for the current transaction, not as a session default.\nThe isolation level of a transaction determines what data the transaction can see when other transactions are running concurrently:\nA statement can only see rows committed before it began. This is the default.\nAll statements of the current transaction can only see rows committed before the first query or data-modification statement was executed in this transaction.\nAll statements of the current transaction can only see rows committed before the first query or data-modification statement was executed in this transaction. If a pattern of reads and writes among concurrent serializable transactions would create a situation which could not have occurred for any serial (one-at-a-time) execution of those transactions, one of them will be rolled back with aserialization_failureerror.\nThe SQL standard defines one additional level,READ UNCOMMITTED. InPostgreSQLREAD UNCOMMITTEDis treated asREAD COMMITTED.\nThe transaction isolation level cannot be changed after the first query or data-modification statement (SELECT,INSERT,DELETE,UPDATE,MERGE,FETCH, orCOPY) of a transaction has been executed. SeeChapter 13for more information about transaction isolation and concurrency control.\nThe transaction access mode determines whether the transaction is read/write or read-only. Read/write is the default. When a transaction is read-only, the following SQL commands are disallowed:INSERT,UPDATE,DELETE,MERGE, andCOPY FROMif the table they would write to is not a temporary table; allCREATE,ALTER, andDROPcommands;COMMENT,GRANT,REVOKE,TRUNCATE; andEXPLAIN ANALYZEandEXECUTEif the command they would execute is among those listed. This is a high-level notion of read-only that does not prevent all writes to disk.\nTheDEFERRABLEtransaction property has no effect unless the transaction is alsoSERIALIZABLEandREAD ONLY. When all three of these properties are selected for a transaction, the transaction may block when first acquiring its snapshot, after which it is able to run without the normal overhead of aSERIALIZABLEtransaction and without any risk of contributing to or being canceled by a serialization failure. This mode is well suited for long-running reports or backups.\nTheSET TRANSACTION SNAPSHOTcommand allows a new transaction to run with the samesnapshotas an existing transaction. The pre-existing transaction must have exported its snapshot with thepg_export_snapshotfunction (seeSection 9.27.5). That function returns a snapshot identifier, which must be given toSET TRANSACTION SNAPSHOTto specify which snapshot is to be imported. The identifier must be written as a string literal in this command, for example'00000003-0000001B-1'.SET TRANSACTION SNAPSHOTcan only be executed at the start of a transaction, before the first query or data-modification statement (SELECT,INSERT,DELETE,UPDATE,MERGE,FETCH, orCOPY) of the transaction. Furthermore, the transaction must already be set toSERIALIZABLEorREPEATABLE READisolation level (otherwise, the snapshot would be discarded immediately, sinceREAD COMMITTEDmode takes a new snapshot for each command). If the importing transaction usesSERIALIZABLEisolation level, then the transaction that exported the snapshot must also use that isolation level. Also, a non-read-only serializable transaction cannot import a snapshot from a read-only transaction.\n"
    },
    {
      "title": "Notes",
      "text": "IfSET TRANSACTIONis executed without a priorSTART TRANSACTIONorBEGIN, it emits a warning and otherwise has no effect.\nIt is possible to dispense withSET TRANSACTIONby instead specifying the desiredtransaction_modesinBEGINorSTART TRANSACTION. But that option is not available forSET TRANSACTION SNAPSHOT.\nThe session default transaction modes can also be set or examined via the configuration parametersdefault_transaction_isolation,default_transaction_read_only, anddefault_transaction_deferrable. (In factSET SESSION CHARACTERISTICSis just a verbose equivalent for setting these variables withSET.) This means the defaults can be set in the configuration file, viaALTER DATABASE, etc. ConsultChapter 20for more information.\nThe current transaction's modes can similarly be set or examined via the configuration parameterstransaction_isolation,transaction_read_only, andtransaction_deferrable. Setting one of these parameters acts the same as the correspondingSET TRANSACTIONoption, with the same restrictions on when it can be done. However, these parameters cannot be set in the configuration file, or from any source other than live SQL.\n"
    },
    {
      "title": "Examples",
      "text": "To begin a new transaction with the same snapshot as an already existing transaction, first export the snapshot from the existing transaction. That will return the snapshot identifier, for example:\n\n\nCODE:\n\nBEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nSELECT pg_export_snapshot();\n pg_export_snapshot\n---------------------\n 00000003-0000001B-1\n(1 row)\n\nThen give the snapshot identifier in aSET TRANSACTION SNAPSHOTcommand at the beginning of the newly opened transaction:\n\n\nCODE:\n\nBEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;\nSET TRANSACTION SNAPSHOT '00000003-0000001B-1';\n\n"
    },
    {
      "title": "Compatibility",
      "text": "These commands are defined in theSQLstandard, except for theDEFERRABLEtransaction mode and theSET TRANSACTION SNAPSHOTform, which arePostgreSQLextensions.\nSERIALIZABLEis the default transaction isolation level in the standard. InPostgreSQLthe default is ordinarilyREAD COMMITTED, but you can change it as mentioned above.\nIn the SQL standard, there is one other transaction characteristic that can be set with these commands: the size of the diagnostics area. This concept is specific to embedded SQL, and therefore is not implemented in thePostgreSQLserver.\nThe SQL standard requires commas between successivetransaction_modes, but for historical reasonsPostgreSQLallows the commas to be omitted.\n"
    }
  ]
}